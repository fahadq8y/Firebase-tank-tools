<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PLCR - Tank Calculator</title>
  <link href="icon.png" rel="icon" type="image/png"/>
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#003366">
  <script type="module">
    import{initializeApp}from'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
    import{getFirestore,doc,getDoc,setDoc,updateDoc,collection,addDoc,serverTimestamp,getDocs}from'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
    const app=initializeApp({apiKey:"AIzaSyD7lJcoY33FEC9d6eWy67QIO9SV4lS24pg",authDomain:"tank-tools-knpc-c2d95.firebaseapp.com",projectId:"tank-tools-knpc-c2d95",storageBucket:"tank-tools-knpc-c2d95.firebasestorage.app",messagingSenderId:"510062594324",appId:"1:510062594324:web:b892fd02007a5ca2f0da01"});
    window.db=getFirestore(app);window.doc=doc;window.getDoc=getDoc;window.setDoc=setDoc;window.addDoc=addDoc;window.serverTimestamp=serverTimestamp;window.collection=collection;window.getDocs=getDocs;
  </script>
  <script src="permissions.js"></script>
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:Arial,sans-serif;margin:0;padding:20px;background:linear-gradient(rgba(0,0,0,0.5),rgba(0,0,0,0.5)),url('background.jpg');background-size:cover;background-position:center;background-attachment:fixed;color:white;direction:ltr;min-height:100vh}
    h2{color:white;text-align:center}
    .nav-bar{display:flex;justify-content:space-between;align-items:center;padding:10px 20px;background:rgba(0,0,0,0.5);border-radius:10px;margin-bottom:20px;flex-wrap:wrap}
    .nav-logo{font-size:24px;font-weight:bold;color:white}
    .nav-links{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .nav-link{color:white;text-decoration:none;padding:8px 16px;border-radius:8px;transition:all 0.3s ease;background:rgba(255,255,255,0.1);font-weight:500;border:1px solid rgba(255,255,255,0.2)}
    .nav-link:hover{background:rgba(255,255,255,0.2);transform:translateY(-1px)}
    .nav-link.active{background:rgba(255,255,255,0.3);font-weight:bold;border:1px solid rgba(255,255,255,0.4)}
    .nav-admin{background:linear-gradient(45deg,#FFD700,#FFA500);color:#003366;font-weight:bold;border-radius:8px;padding:8px 16px;text-decoration:none;transition:all 0.3s ease;border:1px solid #FFA500;font-size:inherit}
    .nav-admin:hover{transform:translateY(-1px);box-shadow:0 4px 12px rgba(255,215,0,0.3)}
    .nav-user{display:flex;align-items:center;gap:10px;background:rgba(255,255,255,0.1);padding:5px 15px;border-radius:20px;backdrop-filter:blur(10px)}
    .user-avatar{width:30px;height:30px;border-radius:50%;background:linear-gradient(45deg,#4CAF50,#45a049);display:flex;align-items:center;justify-content:center;font-weight:bold;font-size:14px}
    .logout-btn{background:rgba(255,0,0,0.2);border:1px solid rgba(255,0,0,0.5);color:white;padding:5px 10px;border-radius:5px;cursor:pointer;font-size:12px;transition:all 0.3s ease}
    .font-controls{display:flex;gap:5px;margin-right:10px}
    .font-btn{background:rgba(255,255,255,0.2);border:1px solid rgba(255,255,255,0.3);color:white;padding:5px 10px;border-radius:5px;cursor:pointer;font-size:14px;font-weight:bold;transition:all 0.3s ease;min-width:30px}
    .font-btn:hover{background:rgba(255,255,255,0.3);transform:translateY(-1px)}
    .container{background:rgba(255,255,255,0.1);padding:20px;border-radius:10px;max-width:600px;margin:auto;box-shadow:0 0 10px rgba(0,0,0,0.3);backdrop-filter:blur(10px)}
    label,input,select{display:block;width:100%;margin:10px 0;text-align:left}
    input,select{padding:10px;border-radius:8px;border:none;background:rgba(255,255,255,0.9);color:#003366;box-shadow:0 2px 5px rgba(0,0,0,0.3)}
    .result{margin-top:20px;font-weight:bold;text-align:center;color:#00ffff;padding:15px;background:rgba(0,0,0,0.3);border-radius:8px}
    footer{margin-top:40px;color:#ccc;text-align:center}
    .whatsapp-link{color:#25D366;text-decoration:none;font-weight:bold;transition:all 0.3s ease;cursor:pointer}
    .whatsapp-link:hover{color:#128C7E;text-shadow:0 0 5px rgba(37,211,102,0.5);transform:scale(1.05)}
    .action-button{position:fixed;width:40px;height:40px;border-radius:50%;background:rgba(255,255,255,0.3);border:none;font-size:20px;color:white;box-shadow:0 2px 5px rgba(0,0,0,0.3);cursor:pointer;display:flex;align-items:center;justify-content:center;top:10px;right:10px}
    .dark-mode{background:linear-gradient(rgba(0,0,0,0.8),rgba(0,0,0,0.8)),url('background.jpg')!important}
    .dark-mode .result{color:#ffcc00!important}
    .dark-mode input,.dark-mode select{background:rgba(50,50,70,0.9)!important;color:#eee!important}
    .dark-mode .container{background:rgba(40,40,60,0.3)!important}.access-denied{position:fixed;top:0;left:0;width:100%;height:100%;background:linear-gradient(rgba(0,0,0,0.8),rgba(0,0,0,0.8)),url('background.jpg');background-size:cover;background-position:center;display:flex;justify-content:center;align-items:center;z-index:9999}
    .access-denied-content{text-align:center;background:rgba(255,255,255,0.1);padding:40px;border-radius:20px;backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,0.2)}
    .access-denied-icon{font-size:5rem;color:#f44336;margin-bottom:20px}
    .access-denied-title{font-size:2rem;color:#f44336;margin-bottom:15px}
    .access-denied-text{font-size:1.2rem;margin-bottom:20px;opacity:0.8}
    .login-btn{padding:12px 25px;background:linear-gradient(45deg,#4CAF50,#45a049);color:white;border:none;border-radius:10px;cursor:pointer;font-size:16px;transition:all 0.3s ease;margin:5px}
    .security-modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.9);z-index:9999;backdrop-filter:blur(5px)}
    .security-modal.show{display:flex;justify-content:center;align-items:center}
    .security-modal-content{background:rgba(255,255,255,0.95);padding:30px;border-radius:15px;max-width:500px;width:90%;color:#003366;text-align:center;animation:modalSlideIn 0.5s ease}
    @keyframes modalSlideIn{from{opacity:0;transform:scale(0.8)}to{opacity:1;transform:scale(1)}}
    .security-icon{font-size:3rem;margin-bottom:15px}
    .security-title{font-size:1.5rem;margin-bottom:15px;font-weight:bold}
    .security-text{margin-bottom:20px;line-height:1.5}
    .attempt-counter{background:rgba(255,193,7,0.2);border:1px solid rgba(255,193,7,0.5);color:#f57c00;padding:10px;border-radius:8px;margin:15px 0;font-weight:bold}
    .security-buttons{display:flex;gap:10px;justify-content:center;flex-wrap:wrap}
    .modal-btn{padding:10px 20px;border:none;border-radius:8px;cursor:pointer;font-weight:500;transition:all 0.3s ease}
    .modal-btn-primary{background:#4CAF50;color:white}
    .modal-btn-secondary{background:#2196F3;color:white}
    .modal-btn-danger{background:#f44336;color:white}
    .modal-btn:hover{transform:translateY(-2px);box-shadow:0 5px 15px rgba(0,0,0,0.3)}
    @media (max-width:600px){
      .nav-bar{flex-direction:column;gap:15px;padding:15px}
      .nav-links{order:1;justify-content:center;width:100%}
      .nav-user{order:2;width:100%;justify-content:space-between}
      .nav-link{padding:10px 15px;font-size:14px}
      .nav-admin{padding:10px 15px;font-size:14px;display:inline-flex;align-items:center}
      .container{padding:15px;margin:10px}
      .security-buttons{flex-direction:column}
      .modal-btn{width:100%}
    }
  </style>
</head>
<body>
  <!-- Security Modal -->
  <div id="securityModal" class="security-modal">
    <div class="security-modal-content">
      <div class="security-icon" id="securityIcon">‚ö†Ô∏è</div>
      <div class="security-title" id="securityTitle">Security Warning</div>
      <div class="security-text" id="securityText">We detected you trying to access developer tools.</div>
      <div class="attempt-counter" id="attemptCounter">Attempts: <span id="attemptCount">1</span>/3</div>
      <div class="security-buttons">
        <button class="modal-btn modal-btn-primary" onclick="acknowledgeWarning()">I Understand</button>
        <button class="modal-btn modal-btn-secondary" onclick="resetPage()">Reset Page</button>
        <button class="modal-btn modal-btn-danger" onclick="learnMore()">Learn More</button>
      </div>
    </div>
  </div>

  <!-- Access Denied -->
  <div id="accessDenied" class="access-denied" style="display:none">
    <div class="access-denied-content">
      <div class="access-denied-icon">üîí</div>
      <div class="access-denied-title">Login Required</div>
      <div class="access-denied-text">You need to login to access PLCR Calculator.<br>Please login with your KNPC credentials.</div>
      <button class="login-btn" onclick="goToLogin()">Go to Login</button>
    </div>
  </div>

  <!-- Main Content -->
  <div id="mainContent">
    <div class="nav-bar">
      <div class="nav-logo">Tank Tools</div>
      <div class="nav-links">
        <a class="nav-link" href="index.html">PBCR</a>
        <a class="nav-link active" href="plcr.html">PLCR</a>
        <a class="nav-link" href="NMOGASBL.html">NMOGAS</a>
        <a class="nav-link" href="live-tanks.html" id="liveTanksLink" style="display:none">üî¥ Live Tanks</a>
        <a class="nav-admin" href="dashboard.html" id="adminLink" style="display:none">üîê Dashboard</a>
      </div>
      <div class="nav-user" id="navUser">
        <div class="font-controls">
          <button class="font-btn" onclick="decreaseFontSize()" title="ÿ™ÿµÿ∫Ÿäÿ± ÿßŸÑÿÆÿ∑">-</button>
          <button class="font-btn" onclick="increaseFontSize()" title="ÿ™ŸÉÿ®Ÿäÿ± ÿßŸÑÿÆÿ∑">+</button>
        </div>
        <div class="user-avatar" id="userAvatar">U</div>
        <div id="userName">User</div>
        <button class="logout-btn" onclick="logout()">Logout</button>
      </div>
    </div>

    <div class="container">
      <h2>PLCR - Tank Calculator</h2>
      
      <label for="mode">Select Mode:</label>
      <select id="mode">
        <option value="levelToBarrels">Level to Barrels</option>
        <option value="barrelsToLevel">Barrels to Level</option>
        <option value="tonToLevel">Metric Ton to Level</option>
        <option value="levelToTon">Level to Metric Ton</option>
      </select>
      
      <label for="tk">Tank Number:</label>
      <input type="number" id="tk" placeholder="e.g. 467" oninput="calculate()">

      <label id="inputLabel" for="value">Enter Value:</label>
      <input type="number" id="value" placeholder="Enter number" oninput="calculate()">

      <div class="result" id="result"></div>
    </div>
    
    <button id="darkModeButton" class="action-button" title="Dark Mode">üåô</button>
    
    <footer>
      By <a href="#" class="whatsapp-link" onclick="openWhatsApp(); return false;">Fahad - 17877</a> ‚Äì Version v4.3 Debug
      <br><small style="color:#999;font-size:10px;margin-top:5px;display:block">üì± WhatsApp: +965 55222550</small>
    </footer>
  </div><script>
    // üîí Smart Security System - iPhone Optimized
    (function(){
      let attempts=0,modalOpen=false,isTyping=false,typingTimer=null;
      
      function initSecurity(){
        const isIPhone=/iPad|iPhone|iPod/.test(navigator.userAgent);
        
        ['focusin','focus','input','keydown','keyup','touchstart'].forEach(eventType=>{
          document.addEventListener(eventType,e=>{
            if(e.target.matches('input,textarea,select')){
              isTyping=true;
              clearTimeout(typingTimer);
              typingTimer=setTimeout(()=>isTyping=false,isIPhone?1500:800);
            }
          },true);
        });
        
        document.addEventListener('change',e=>{
          if(e.target.matches('input,textarea,select')){
            isTyping=true;
            clearTimeout(typingTimer);
            typingTimer=setTimeout(()=>isTyping=false,1000);
          }
        });
        
        document.addEventListener('contextmenu',e=>{
          if(isTyping||e.target.matches('input,textarea,select')||e.target.closest('input,textarea,select'))return;
          handleViolation('context-menu')(e);
        });
        
        document.addEventListener('selectstart',e=>{
          if(isTyping||e.target.matches('input,textarea,select')||e.target.closest('input,textarea,select'))return;
          handleViolation('text-selection')(e);
        });
        
        document.addEventListener('keydown',e=>{
          if(isTyping||e.target.matches('input,textarea,select')||e.target.closest('input,textarea,select'))return;
          const dangerous=[(e.ctrlKey&&e.key==='u'),(e.ctrlKey&&e.key==='s'),(e.ctrlKey&&e.shiftKey&&e.key==='I'),(e.key==='F12'),(e.ctrlKey&&e.shiftKey&&e.key==='C'),(e.ctrlKey&&e.shiftKey&&e.key==='J')];
          if(dangerous.some(c=>c))handleViolation('keyboard-shortcut')(e);
        });
        
        let devOpen=false;
        setInterval(()=>{
          if(isTyping)return;
          const threshold=160,wDiff=window.outerWidth-window.innerWidth,hDiff=window.outerHeight-window.innerHeight;
          if(wDiff>threshold||hDiff>threshold){
            if(!devOpen){devOpen=true;setTimeout(()=>{if(!isTyping)handleViolation('devtools-detected')()},500)}
          }else{devOpen=false}
        },isIPhone?5000:3000);
      }
      
      function handleViolation(type){
        return function(e){
          if(e&&e.preventDefault)e.preventDefault();
          attempts++;
          if(attempts===1)showWarning('first');
          else if(attempts===2)showWarning('second');
          else if(attempts>=3)showWarning('final');
          return false
        }
      }
      
      function showWarning(level){
        if(modalOpen)return;
        const modal=document.getElementById('securityModal'),icon=document.getElementById('securityIcon'),title=document.getElementById('securityTitle'),text=document.getElementById('securityText'),counter=document.getElementById('attemptCounter'),countSpan=document.getElementById('attemptCount');
        modalOpen=true;countSpan.textContent=attempts;
        if(level==='first'){
          icon.textContent='üëÄ';title.textContent='Security Notice';
          text.innerHTML='<p>We noticed you tried to access developer tools on PLCR Calculator.</p><p><strong>If this was accidental:</strong> No problem! Click "I Understand" to continue.</p><p><strong>Note:</strong> This calculator contains KNPC tank conversion data.</p>';
          counter.style.background='rgba(33,150,243,0.2)';counter.style.borderColor='rgba(33,150,243,0.5)';counter.style.color='#2196F3'
        }else if(level==='second'){
          icon.textContent='‚ö†Ô∏è';title.textContent='Security Warning';
          text.innerHTML='<p><strong>Second attempt detected on PLCR Calculator.</strong></p><p>Please note this system contains:</p><ul style="text-align:left;margin:10px 0"><li>Proprietary tank conversion algorithms</li><li>KNPC operational data</li><li>Protected calculation methods</li></ul><p>One more attempt will activate security measures.</p>';
          counter.style.background='rgba(255,193,7,0.2)';counter.style.borderColor='rgba(255,193,7,0.5)';counter.style.color='#ffc107'
        }else{
          icon.textContent='üö´';title.textContent='PLCR Security Lock';
          text.innerHTML='<p><strong>Maximum attempts exceeded on PLCR Calculator.</strong></p><p>Enhanced monitoring activated for:</p><ul style="text-align:left;margin:10px 0"><li>Tank calculation protection</li><li>KNPC data security</li><li>System integrity maintenance</li></ul><p>Use "Reset Page" to continue normally.</p>';
          counter.style.background='rgba(244,67,54,0.2)';counter.style.borderColor='rgba(244,67,54,0.5)';counter.style.color='#f44336';
          setTimeout(()=>{if(attempts>=3)implementRestrictions()},5000)
        }
        modal.classList.add('show')
      }
      
      function implementRestrictions(){
        document.body.style.filter='blur(3px)';
        const overlay=document.createElement('div');
        overlay.innerHTML='<div style="position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.7);color:white;display:flex;flex-direction:column;justify-content:center;align-items:center;z-index:10000;text-align:center;padding:20px"><div style="font-size:4rem;margin-bottom:20px">‚öóÔ∏è</div><h2 style="color:#FFD700;margin-bottom:15px">PLCR Calculator Protected</h2><p style="margin-bottom:30px;max-width:500px;line-height:1.5">Security monitoring active for tank conversion calculations and KNPC operational data.</p><button onclick="window.location.reload()" style="padding:12px 24px;background:#FFD700;color:#003366;border:none;border-radius:8px;cursor:pointer;font-size:16px;font-weight:bold">üîÑ Reset Calculator</button></div>';
        document.body.appendChild(overlay)
      }
      
      window.acknowledgeWarning=()=>{document.getElementById('securityModal').classList.remove('show');modalOpen=false;showMessage(attempts>=3?'‚ö†Ô∏è Enhanced monitoring active':'‚úÖ Continue using PLCR normally','success')};
      window.resetPage=()=>window.location.reload();
      window.learnMore=()=>{showMessage('üîí PLCR protects KNPC tank conversion data and calculation algorithms. Contact Fahad - 17877 for support.','info');document.getElementById('securityModal').classList.remove('show');modalOpen=false};
      initSecurity()
    })();

    // PLCR Application Variables
    const WHATSAPP_NUMBER="96555222550";
    let currentUser=null,c=0,m=0,x=0,calcData=null;
    let tanks={};
    let products={};

    // Login and Initialization System
    window.addEventListener('load',()=>{
      setTimeout(() => {
        checkLogin();
        setTimeout(() => {
          loadTankDataFromFirebase();
          loadProductsFromFirebase();
        }, 1000);
      }, 100);
    });

    function checkLogin(){
      const s=sessionStorage.getItem('tanktools_session'),u=localStorage.getItem('tanktools_current_user');
      if(s!=='active'||!u){
        showAccess();
        return;
      }
      try{
        currentUser=JSON.parse(u);
        if(!currentUser||!currentUser.username){
          showAccess();
          return;
        }
        
        if (window.PermissionsManager) {
          window.permissionsManager = new PermissionsManager();
          window.permissionsManager.loadUserPermissions(currentUser.username).then(() => {
            initApp();
          }).catch(() => {
            initApp();
          });
        } else {
          initApp();
        }
      }catch{
        showAccess();
      }
    }

    function showAccess(){
      document.getElementById('mainContent').style.display='none';
      document.getElementById('accessDenied').style.display='flex';
    }

    window.goToLogin=()=>{
      sessionStorage.setItem('tanktools_redirect','plcr.html');
      window.location.href='login.html';
    };

    function initApp(){
      document.getElementById('mainContent').style.display='block';
      document.getElementById('accessDenied').style.display='none';
      loadUser();
      loadDataFromLocalStorage();
      setupDarkMode();
    }

    function loadUser(){
      if(!currentUser)return;
      document.getElementById('userName').textContent=currentUser.fullName || currentUser.username;
      document.getElementById('userAvatar').textContent=(currentUser.fullName||currentUser.username).charAt(0).toUpperCase();
      
      if(currentUser.username==='fam030'||currentUser.role==='admin')
        document.getElementById('adminLink').style.display='inline-block';
      
      const roles=["admin","panel_operator","supervisor","section_head","operator","planning"];
      if(roles.includes(currentUser.role))
        document.getElementById('liveTanksLink').style.display='inline-block';
    }

    window.logout=()=>{
      sessionStorage.removeItem('tanktools_session');
      localStorage.removeItem('tanktools_current_user');
      window.location.href='login.html';
    };// Login and Initialization System
    window.addEventListener('load',()=>{
      setTimeout(() => {
        checkLogin();
        setTimeout(() => {
          loadTankDataFromFirebase();
          loadProductsFromFirebase();
        }, 1000);
      }, 100);
    });

    function checkLogin(){
      const s=sessionStorage.getItem('tanktools_session'),u=localStorage.getItem('tanktools_current_user');
      if(s!=='active'||!u){
        showAccess();
        return;
      }
      try{
        currentUser=JSON.parse(u);
        if(!currentUser||!currentUser.username){
          showAccess();
          return;
        }
        
        if (window.PermissionsManager) {
          window.permissionsManager = new PermissionsManager();
          window.permissionsManager.loadUserPermissions(currentUser.username).then(() => {
            initApp();
          }).catch(() => {
            initApp();
          });
        } else {
          initApp();
        }
      }catch{
        showAccess();
      }
    }

    function showAccess(){
      document.getElementById('mainContent').style.display='none';
      document.getElementById('accessDenied').style.display='flex';
    }

    window.goToLogin=()=>{
      sessionStorage.setItem('tanktools_redirect','plcr.html');
      window.location.href='login.html';
    };

    function initApp(){
      document.getElementById('mainContent').style.display='block';
      document.getElementById('accessDenied').style.display='none';
      loadUser();
      loadDataFromLocalStorage();
      setupDarkMode();
    }

    function loadUser(){
      if(!currentUser)return;
      document.getElementById('userName').textContent=currentUser.fullName || currentUser.username;
      document.getElementById('userAvatar').textContent=(currentUser.fullName||currentUser.username).charAt(0).toUpperCase();
      
      if(currentUser.username==='fam030'||currentUser.role==='admin')
        document.getElementById('adminLink').style.display='inline-block';
      
      const roles=["admin","panel_operator","supervisor","section_head","operator","planning"];
      if(roles.includes(currentUser.role))
        document.getElementById('liveTanksLink').style.display='inline-block';
    }

    window.logout=()=>{
      sessionStorage.removeItem('tanktools_session');
      localStorage.removeItem('tanktools_current_user');
      window.location.href='login.html';
    };

    // DEBUG VERSION: Load tank data from Firebase with detailed logging
    async function loadTankDataFromFirebase() {
  try {
    const statusDiv = document.getElementById("result");
    if (statusDiv) statusDiv.textContent = "üîÑ DEBUG: Loading PLCR tank data from Firebase...";
    
    console.log('üîÑ DEBUG: Starting PLCR Firebase loading...');
    
    let dataLoaded = false;
    
    // Path 1: ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ŸÜŸÅÿ≥ ŸÖÿ≥ÿßÿ± PBCR ÿßŸÑÿ∞Ÿä Ÿäÿ¥ÿ™ÿ∫ŸÑ - tanks/tanks
    try {
      console.log('üîç DEBUG: Trying tanks/tanks (same as PBCR)...');
      
      const tanksSnapshot = await getDoc(doc(db, 'tanks', 'tanks'));
      if (tanksSnapshot.exists()) {
        const tanksData = tanksSnapshot.data();
        console.log('üìä DEBUG: tanks/tanks data keys:', Object.keys(tanksData));
        
        // ÿßŸÑÿ®ÿ≠ÿ´ ÿπŸÜ ÿ®ŸäÿßŸÜÿßÿ™ PLCR ŸÅŸä ŸÜŸÅÿ≥ ŸÖŸÉÿßŸÜ PBCR
        for (let tankId in tanksData) {
          const tankData = tanksData[tankId];
          
          // ŸÅŸÑÿ™ÿ±ÿ© ÿßŸÑÿ™ŸàÿßŸÜŸÉŸä ÿ≠ÿ≥ÿ® ÿßŸÑŸÜŸàÿπ ÿ£Ÿà ÿßŸÑÿ±ŸÇŸÖ
          // PLCR tanks ÿπÿßÿØÿ© ÿ£ÿ±ŸÇÿßŸÖŸáÿß: 101, 204, 255, 256, 272, 273, 274, 275, 281, 282, 301, 302, 424, 425, 426, 456, 460, 461, 462, 467, 468, 469, 470, 521, 522, 531, 532, 533, 534, 600, 601, 603, 620, 621, 622, 664, 665, 668, 669, 670, 671, 672, 702, 703, 705
          const plcrTankNumbers = ['101', '204', '255', '256', '272', '273', '274', '275', '281', '282', '301', '302', '424', '425', '426', '456', '460', '461', '462', '467', '468', '469', '470', '521', '522', '531', '532', '533', '534', '600', '601', '603', '620', '621', '622', '664', '665', '668', '669', '670', '671', '672', '702', '703', '705'];
          
          if (plcrTankNumbers.includes(tankId)) {
            console.log(`üîç DEBUG: Found potential PLCR tank ${tankId}:`, tankData);
            
            // PLCR Ÿäÿ≠ÿ™ÿßÿ¨ gross Ÿà factor
            if (tankData.gross && tankData.factor !== undefined) {
              tanks[tankId] = {
                comment: tankData.gross,
                min: tankData.factor,
                max: tankData.factor
              };
              console.log(`‚úÖ DEBUG: Added PLCR tank ${tankId} with gross=${tankData.gross}, factor=${tankData.factor}`);
            }
            // ÿ™ÿ¨ÿ±ÿ®ÿ© ÿßŸÑÿ®ÿ≠ÿ´ ÿπŸÜ ÿµŸäÿ∫ÿ© ÿ£ÿÆÿ±Ÿâ
            else if (tankData.capacity && tankData.min !== undefined) {
              tanks[tankId] = {
                comment: tankData.capacity,
                min: tankData.min,
                max: tankData.max || tankData.min
              };
              console.log(`‚úÖ DEBUG: Added PLCR tank ${tankId} with capacity format`);
            }
            // ÿ™ÿ¨ÿ±ÿ®ÿ© ÿ£Ÿä ÿ®ŸäÿßŸÜÿßÿ™ ŸÖÿ™ŸàŸÅÿ±ÿ©
            else if (tankData.comment !== undefined) {
              tanks[tankId] = {
                comment: tankData.comment,
                min: tankData.min || 1.0,
                max: tankData.max || 1.0
              };
              console.log(`‚úÖ DEBUG: Added PLCR tank ${tankId} with comment format`);
            }
            else {
              console.log(`‚ùå DEBUG: PLCR tank ${tankId} missing required fields:`, Object.keys(tankData));
            }
          }
        }
        
        if (Object.keys(tanks).length > 0) {
          dataLoaded = true;
          const message = `‚úÖ DEBUG: PLCR tanks loaded from tanks/tanks: ${Object.keys(tanks).length} tanks`;
          console.log(message);
          if (statusDiv) statusDiv.textContent = message;
        }
      }
    } catch (e) {
      console.log('‚ùå DEBUG: tanks/tanks approach failed:', e.message);
    }
    
    // Path 2: ŸÖÿ≠ÿßŸàŸÑÿ© ŸÇÿ±ÿßÿ°ÿ© ŸÖŸÜ pbcr/tanks (ŸÖÿ¥ÿßÿ±ŸÉÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™)
    if (!dataLoaded || Object.keys(tanks).length < 5) {
      try {
        console.log('üîç DEBUG: Trying pbcr/tanks for shared data...');
        
        const pbcrSnapshot = await getDoc(doc(db, 'pbcr', 'tanks'));
        if (pbcrSnapshot.exists()) {
          const pbcrData = pbcrSnapshot.data();
          console.log('üìä DEBUG: pbcr/tanks data available');
          
          // ÿßŸÑÿ®ÿ≠ÿ´ ÿπŸÜ ÿ£ÿ±ŸÇÿßŸÖ PLCR ŸÅŸä ÿ®ŸäÿßŸÜÿßÿ™ PBCR
          const plcrTankNumbers = ['101', '204', '255', '256', '272', '273', '274', '275', '281', '282', '301', '302', '424', '425', '426', '456', '460', '461', '462', '467', '468', '469', '470', '521', '522', '531', '532', '533', '534', '600', '601', '603', '620', '621', '622', '664', '665', '668', '669', '670', '671', '672', '702', '703', '705'];
          
          for (let tankId in pbcrData) {
            if (plcrTankNumbers.includes(tankId)) {
              const tankData = pbcrData[tankId];
              
              if (tankData.capacity && tankData.min !== undefined) {
                tanks[tankId] = {
                  comment: tankData.capacity,
                  min: tankData.min,
                  max: tankData.max || tankData.min
                };
                console.log(`‚úÖ DEBUG: Added PLCR tank ${tankId} from PBCR data`);
              }
            }
          }
        }
        
        if (Object.keys(tanks).length > 0) {
          dataLoaded = true;
          const message = `‚úÖ DEBUG: PLCR tanks loaded from PBCR: ${Object.keys(tanks).length} tanks`;
          console.log(message);
          if (statusDiv) statusDiv.textContent = message;
        }
      } catch (e) {
        console.log('‚ùå DEBUG: pbcr/tanks approach failed:', e.message);
      }
    }
    
    // Path 3: Fallback - ÿ•ÿ∂ÿßŸÅÿ© tank 467 ŸäÿØŸàŸäÿßŸã ŸÑŸÑÿßÿÆÿ™ÿ®ÿßÿ±
    if (!dataLoaded || !tanks['467']) {
      console.log('üîß DEBUG: Adding fallback tank 467 for testing...');
      tanks['467'] = {
        comment: 9054,  // gross
        min: 1.358,     // factor
        max: 1.358      // factor
      };
      console.log('‚úÖ DEBUG: Added fallback tank 467');
      
      if (statusDiv) statusDiv.textContent = `‚ö†Ô∏è DEBUG: Using fallback data for tank 467`;
    }
    
    // Debug: Show what tanks we have
    console.log('üéØ DEBUG: Final tanks loaded:', Object.keys(tanks));
    console.log('üîç DEBUG: Tank 467 data:', tanks['467']);
    
    // Clear status after 8 seconds
    setTimeout(() => {
      if (statusDiv && statusDiv.textContent.includes('DEBUG')) {
        statusDiv.textContent = "";
      }
    }, 8000);
    
  } catch (error) {
    const statusDiv = document.getElementById("result");
    const message = `‚ùå DEBUG: Firebase Error: ${error.message}`;
    console.error('üî• DEBUG: Firebase loading error:', error);
    if (statusDiv) statusDiv.textContent = message;
  }
}
      try {
        const statusDiv = document.getElementById("result");
        if (statusDiv) statusDiv.textContent = "üîÑ DEBUG: Loading PLCR tank data from Firebase...";
        
        console.log('üîÑ DEBUG: Starting PLCR Firebase loading...');
        
        let dataLoaded = false;
        
        // Path 1: Try to read from tankData/plcr/tanks as a collection
        try {
          console.log('üîç DEBUG: Trying tankData/plcr/tanks collection approach...');
          
          // Read the tanks collection under tankData/plcr
          const tanksCollectionRef = collection(db, 'tankData', 'plcr', 'tanks');
          const tanksSnapshot = await getDocs(tanksCollectionRef);
          
          console.log('üìä DEBUG: Collection size:', tanksSnapshot.size);
          console.log('üìä DEBUG: Collection empty?', tanksSnapshot.empty);
          
          if (!tanksSnapshot.empty) {
            tanksSnapshot.forEach((doc) => {
              const tankId = doc.id;
              const tankData = doc.data();
              
              console.log(`üîç DEBUG: Processing tank ${tankId}:`, tankData);
              
              // For PLCR: look for gross and factor
              if (tankData.gross && tankData.factor !== undefined) {
                tanks[tankId] = {
                  comment: tankData.gross,
                  min: tankData.factor,
                  max: tankData.factor
                };
                console.log(`‚úÖ DEBUG: Added tank ${tankId} with gross=${tankData.gross}, factor=${tankData.factor}`);
              }
              // Also check for capacity/min/max format
              else if (tankData.capacity && tankData.min !== undefined && tankData.max !== undefined) {
                tanks[tankId] = {
                  comment: tankData.capacity,
                  min: tankData.min,
                  max: tankData.max
                };
                console.log(`‚úÖ DEBUG: Added tank ${tankId} with capacity=${tankData.capacity}`);
              }
              else {
                console.log(`‚ùå DEBUG: Tank ${tankId} missing required fields. Available fields:`, Object.keys(tankData));
              }
            });
            
            if (Object.keys(tanks).length > 0) {
              dataLoaded = true;
              const message = `‚úÖ DEBUG: PLCR tanks loaded from collection: ${Object.keys(tanks).length} tanks`;
              console.log(message);
              if (statusDiv) statusDiv.textContent = message;
            }
          } else {
            console.log('‚ùå DEBUG: Collection is empty');
          }
        } catch (e) {
          console.log('‚ùå DEBUG: Collection approach failed:', e.message);
        }
        
        // Path 2: Try document approach (fallback)
        if (!dataLoaded || Object.keys(tanks).length < 5) {
          try {
            console.log('üîç DEBUG: Trying document approach as fallback...');
            
            const plcrTankDataSnapshot = await getDoc(doc(db, 'tankData', 'plcr'));
            console.log('üìÑ DEBUG: Document exists?', plcrTankDataSnapshot.exists());
            
            if (plcrTankDataSnapshot.exists()) {
              const plcrTankData = plcrTankDataSnapshot.data();
              console.log('üìÑ DEBUG: Document data keys:', Object.keys(plcrTankData));
              console.log('üìÑ DEBUG: Full document data:', plcrTankData);
              
              if (plcrTankData.tanks) {
                console.log('üìÑ DEBUG: Found tanks field with keys:', Object.keys(plcrTankData.tanks));
                for (let tankId in plcrTankData.tanks) {
                  const tankData = plcrTankData.tanks[tankId];
                  console.log(`üîç DEBUG: Document tank ${tankId}:`, tankData);
                  
                  if (tankData.gross && tankData.factor !== undefined) {
                    tanks[tankId] = {
                      comment: tankData.gross,
                      min: tankData.factor,
                      max: tankData.factor
                    };
                    console.log(`‚úÖ DEBUG: Added tank ${tankId} from document`);
                  }
                }
              } else {
                console.log('‚ùå DEBUG: No tanks field in document');
              }
            }
            
            if (Object.keys(tanks).length > 0) {
              dataLoaded = true;
              const message = `‚úÖ DEBUG: PLCR tanks loaded from document: ${Object.keys(tanks).length} tanks`;
              console.log(message);
              if (statusDiv) statusDiv.textContent = message;
            }
          } catch (e) {
            console.log('‚ùå DEBUG: Document approach failed:', e.message);
          }
        }
        
        // Debug: Show what tanks we have
        console.log('üéØ DEBUG: Final tanks loaded:', Object.keys(tanks));
        console.log('üîç DEBUG: Looking for tank 467:', tanks['467']);
        console.log('üîç DEBUG: Tank 467 exists?', tanks.hasOwnProperty('467'));
        
        if (!dataLoaded || Object.keys(tanks).length === 0) {
          const message = "‚ùå DEBUG: No PLCR tank data found in Firebase";
          console.error(message);
          if (statusDiv) statusDiv.textContent = message;
        }
        
        // Clear status after 8 seconds (longer for debugging)
        setTimeout(() => {
          if (statusDiv && (statusDiv.textContent.includes('loaded') || statusDiv.textContent.includes('tanks'))) {
            statusDiv.textContent = "";
          }
        }, 8000);
        
      } catch (error) {
        const statusDiv = document.getElementById("result");
        const message = `‚ùå DEBUG: Firebase Error: ${error.message}`;
        console.error('üî• DEBUG: Firebase loading error:', error);
        if (statusDiv) statusDiv.textContent = message;
      }
    }// Load products from Firebase
    async function loadProductsFromFirebase() {
      try {
        console.log('üîÑ DEBUG: Loading products from Firebase...');
        const systemSnapshot = await getDoc(doc(db, 'system', 'products'));
        if (systemSnapshot.exists()) {
          products = systemSnapshot.data().products || {};
          console.log('‚úÖ DEBUG: Products loaded from system collection');
        } else {
          products = {
            "PBCR": ["LSFO", "EGO 10PPM", "EGO 500PPM", "RHN", "PCNA", "NMOGAS", "OLMOGAS", "ATK", "ARDR", "IC5", "ISOM", "SLOP"],
            "WASHERY": ["MOGAS 98", "MOGAS 95", "MOGAS 91", "GO", "KERO", "ATK", "Slop"],
            "PLCR": ["Heavy Oil", "Light Product", "Mixed Product", "Refined Oil", "Final Product", "Blended Oil"]
          };
          console.log('‚úÖ DEBUG: Using default products');
        }
      } catch (error) {
        console.error('‚ùå DEBUG: Error loading products:', error);
        products = {
          "PBCR": ["LSFO", "EGO 10PPM", "EGO 500PPM", "RHN", "PCNA", "NMOGAS", "OLMOGAS", "ATK", "ARDR", "IC5", "ISOM", "SLOP"],
          "WASHERY": ["MOGAS 98", "MOGAS 95", "MOGAS 91", "GO", "KERO", "ATK", "Slop"],
          "PLCR": ["Heavy Oil", "Light Product", "Mixed Product", "Refined Oil", "Final Product", "Blended Oil"]
        };
      }
    }

    // DEBUG VERSION: PLCR Calculate Function with detailed logging
    window.calculate = () => {
      const tk = document.getElementById("tk").value.trim();
      const value = parseFloat(document.getElementById("value").value);
      const resultDiv = document.getElementById("result");
      const mode = document.getElementById("mode").value;
      
      console.log(`üîç DEBUG: Calculate called with tank=${tk}, value=${value}, mode=${mode}`);
      console.log(`üîç DEBUG: Available tanks:`, Object.keys(tanks));
      console.log(`üîç DEBUG: Tank ${tk} exists?`, tanks.hasOwnProperty(tk));
      
      if (!tk) {
        resultDiv.textContent = "DEBUG: Please enter a tank number.";
        console.log('‚ùå DEBUG: No tank number entered');
        return;
      }
      
      if (!tanks[tk]) {
        const message = `DEBUG: Tank ${tk} not found in PLCR database. Available tanks: ${Object.keys(tanks).slice(0,5).join(', ')}${Object.keys(tanks).length > 5 ? '...' : ''}`;
        resultDiv.textContent = message;
        console.log(`‚ùå DEBUG: Tank ${tk} not found. Available:`, Object.keys(tanks));
        return;
      }
      
      if (isNaN(value)) {
        resultDiv.textContent = "DEBUG: Please enter a valid number.";
        console.log('‚ùå DEBUG: Invalid value entered');
        return;
      }
      
      const tank = tanks[tk];
      const gross = tank.comment;  // gross value
      const factor = tank.min;     // factor value
      
      console.log(`‚úÖ DEBUG: Using tank ${tk} with gross=${gross}, factor=${factor}`);
      
      let metricTon, barrels, level;
      
      switch (mode) {
        case "levelToBarrels":
          metricTon = value * factor;
          barrels = metricTon * gross;
          resultDiv.textContent = `Weight: ${metricTon.toFixed(2)} MT | Barrels: ${barrels.toFixed(2)} BBL`;
          console.log(`‚úÖ DEBUG: Level to Barrels: ${value} ‚Üí ${metricTon.toFixed(2)} MT ‚Üí ${barrels.toFixed(2)} BBL`);
          break;
          
        case "barrelsToLevel":
          metricTon = value / gross;
          level = metricTon / factor;
          resultDiv.textContent = `Weight: ${metricTon.toFixed(2)} MT | Approx. Level: ${level.toFixed(2)}`;
          console.log(`‚úÖ DEBUG: Barrels to Level: ${value} BBL ‚Üí ${metricTon.toFixed(2)} MT ‚Üí ${level.toFixed(2)} level`);
          break;
          
        case "tonToLevel":
          level = value / factor;
          resultDiv.textContent = `Approx. Level: ${level.toFixed(2)}`;
          console.log(`‚úÖ DEBUG: Ton to Level: ${value} MT ‚Üí ${level.toFixed(2)} level`);
          break;
          
        case "levelToTon":
          metricTon = value * factor;
          resultDiv.textContent = `Weight: ${metricTon.toFixed(2)} MT`;
          console.log(`‚úÖ DEBUG: Level to Ton: ${value} ‚Üí ${metricTon.toFixed(2)} MT`);
          break;
          
        default:
          resultDiv.textContent = "DEBUG: Please select a valid mode and enter data.";
          console.log('‚ùå DEBUG: Invalid mode selected');
      }
      
      saveDataToLocalStorage();
    };

    // Utility Functions
    function showMessage(message,type){
      const div=document.createElement('div');
      div.innerHTML=message;
      div.style.cssText=`position:fixed;top:20px;right:20px;background:${type==='success'?'#4CAF50':type==='warning'?'#ff9800':'#2196F3'};color:white;padding:15px 20px;border-radius:8px;z-index:10000;max-width:400px;box-shadow:0 4px 12px rgba(0,0,0,0.3)`;
      document.body.appendChild(div);
      setTimeout(()=>div.remove(),5000)
    }

    const modeSelect=document.getElementById("mode"),inputLabel=document.getElementById("inputLabel");
    
    modeSelect.addEventListener("change",()=>{
      const mode=modeSelect.value;
      const labelMap={levelToBarrels:"Current Level:",barrelsToLevel:"Current Barrels:",tonToLevel:"Weight (MT):",levelToTon:"Current Level:"};
      inputLabel.textContent=labelMap[mode]||"Enter value:";
      calculate()
    });

    function saveDataToLocalStorage(){
      const data={tk:document.getElementById("tk").value,value:document.getElementById("value").value,mode:document.getElementById("mode").value};
      localStorage.setItem('plcrData',JSON.stringify(data))
    }

    function loadDataFromLocalStorage(){
      const dataStr=localStorage.getItem('plcrData');
      if(dataStr){
        const data=JSON.parse(dataStr);
        document.getElementById("tk").value=data.tk||'';
        document.getElementById("value").value=data.value||'';
        document.getElementById("mode").value=data.mode||'levelToBarrels';
        const mode=data.mode,labelMap={levelToBarrels:"Current Level:",barrelsToLevel:"Current Barrels:",tonToLevel:"Weight (MT):",levelToTon:"Current Level:"};
        inputLabel.textContent=labelMap[mode]||"Enter value:";
        if(data.tk&&data.value)calculate()
      }
    }

    window.openWhatsApp=()=>{
      const message="ŸÖÿ±ÿ≠ÿ®ÿßÿå ÿ£ÿ™ŸàÿßÿµŸÑ ŸÖÿπŸÉ ŸÖŸÜ ÿÆŸÑÿßŸÑ ÿ™ÿ∑ÿ®ŸäŸÇ PLCR Tank Calculator - Debug Version",whatsappURL=`https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(message)}`;
      try{const newWindow=window.open(whatsappURL,'_blank','noopener,noreferrer');if(!newWindow)window.location.href=whatsappURL}
      catch{navigator.clipboard.writeText(whatsappURL).then(()=>alert(`ÿ™ŸÖ ŸÜÿ≥ÿÆ ÿ±ÿßÿ®ÿ∑ ÿßŸÑŸàÿßÿ™ÿ≥ÿßÿ®:\n${whatsappURL}`)).catch(()=>alert(`ÿ±ÿßÿ®ÿ∑ ÿßŸÑŸàÿßÿ™ÿ≥ÿßÿ®:\n${whatsappURL}`))}
    };

    function setupDarkMode(){
      let isDarkMode=localStorage.getItem('darkMode')==='true';
      const darkModeButton=document.getElementById('darkModeButton');
      function updateColorMode(){
        if(isDarkMode){document.body.classList.add('dark-mode');darkModeButton.innerHTML='‚òÄÔ∏è'}
        else{document.body.classList.remove('dark-mode');darkModeButton.innerHTML='üåô'}
      }
      darkModeButton.addEventListener('click',()=>{isDarkMode=!isDarkMode;localStorage.setItem('darkMode',isDarkMode);updateColorMode()});
      updateColorMode()
    }

    // Font size control functions
    let currentFontSize = parseInt(localStorage.getItem('tanktools_font_size_plcr') || '16');
    
    function increaseFontSize() {
      if (currentFontSize < 24) {
        currentFontSize += 2;
        applyFontSize();
        localStorage.setItem('tanktools_font_size_plcr', currentFontSize);
        showFontMessage(`üìà Font size increased to ${currentFontSize}px`);
      }
    }
    
    function decreaseFontSize() {
      if (currentFontSize > 12) {
        currentFontSize -= 2;
        applyFontSize();
        localStorage.setItem('tanktools_font_size_plcr', currentFontSize);
        showFontMessage(`üìâ Font size decreased to ${currentFontSize}px`);
      }
    }
    
    function applyFontSize() {
      const style = document.createElement('style');
      style.id = 'dynamic-font-style';
      
      const existingStyle = document.getElementById('dynamic-font-style');
      if (existingStyle) {
        existingStyle.remove();
      }
      
      style.textContent = `
        input, select { font-size: ${currentFontSize}px !important; }
        label { font-size: ${currentFontSize}px !important; }
        .result { font-size: ${currentFontSize}px !important; }
        h2 { font-size: ${currentFontSize + 8}px !important; }
        .container { font-size: ${currentFontSize}px !important; }
      `;
      
      document.head.appendChild(style);
    }
    
    function showFontMessage(message) {
      const msgDiv = document.createElement('div');
      msgDiv.style.cssText = 'position:fixed;top:80px;right:20px;background:rgba(76,175,80,0.9);color:white;padding:10px 15px;border-radius:8px;font-size:12px;z-index:1000;animation:slideIn 0.3s ease';
      msgDiv.textContent = message;
      document.body.appendChild(msgDiv);
      setTimeout(() => msgDiv.remove(), 3000);
    }
    
    // Apply saved font size on page load
    applyFontSize();
    
    window.increaseFontSize = increaseFontSize;
    window.decreaseFontSize = decreaseFontSize;

    // Auto-save
    document.addEventListener('input',e=>{if(e.target.matches('#tk,#value'))saveDataToLocalStorage()});
    
    console.log('%cüîí PLCR CALCULATOR - DEBUG VERSION','color:red;font-size:16px;font-weight:bold');
    console.log('%cüîç Full debugging enabled - Check console for details','color:orange;font-size:14px;font-weight:bold');
    console.log('%cDeveloper: Fahad - 17877','color:green;font-size:14px');

// Debug Button - Ÿäÿ∏Ÿáÿ± ŸÖÿπŸÑŸàŸÖÿßÿ™ Firebase ÿπŸÑŸâ ÿßŸÑÿ¥ÿßÿ¥ÿ© ŸÖÿ®ÿßÿ¥ÿ±ÿ©
function createDebugButton() {
  const debugBtn = document.createElement('button');
  debugBtn.innerHTML = 'üîç DEBUG';
  debugBtn.style.cssText = 'position:fixed;top:60px;right:10px;background:#ff4444;color:white;border:none;padding:10px;border-radius:8px;cursor:pointer;z-index:9999;font-weight:bold;';
  
  debugBtn.onclick = function() {
    showDebugInfo();
  };
  
  document.body.appendChild(debugBtn);
}

// ÿπÿ±ÿ∂ ŸÖÿπŸÑŸàŸÖÿßÿ™ Debug ÿπŸÑŸâ ÿßŸÑÿ¥ÿßÿ¥ÿ©
function showDebugInfo() {
  const debugDiv = document.createElement('div');
  debugDiv.id = 'debugInfo';
  debugDiv.style.cssText = 'position:fixed;top:100px;right:10px;background:rgba(0,0,0,0.9);color:#00ff00;padding:20px;border-radius:10px;z-index:9999;max-width:400px;font-family:monospace;font-size:12px;max-height:500px;overflow-y:auto;';
  
  let debugText = `üîç PLCR DEBUG INFO:\n\n`;
  debugText += `üìä Total tanks loaded: ${Object.keys(tanks).length}\n`;
  debugText += `üìã Available tanks: ${Object.keys(tanks).slice(0,10).join(', ')}${Object.keys(tanks).length > 10 ? '...' : ''}\n\n`;
  
  debugText += `üîç Tank 467 exists: ${tanks.hasOwnProperty('467') ? 'YES' : 'NO'}\n`;
  if (tanks['467']) {
    debugText += `üìÑ Tank 467 data: ${JSON.stringify(tanks['467'])}\n`;
  }
  
  debugText += `\nüîß Firebase Connection: ${typeof db !== 'undefined' ? 'CONNECTED' : 'FAILED'}\n`;
  debugText += `üîß getDocs function: ${typeof getDocs !== 'undefined' ? 'AVAILABLE' : 'MISSING'}\n`;
  debugText += `üîß collection function: ${typeof collection !== 'undefined' ? 'AVAILABLE' : 'MISSING'}\n`;
  
  debugText += `\nüìÇ Firebase Paths Tested:\n`;
  debugText += `‚Ä¢ tankData/plcr/tanks (collection)\n`;
  debugText += `‚Ä¢ tankData/plcr (document)\n`;
  
  debugText += `\nüéØ Current User: ${currentUser ? currentUser.username : 'NOT LOGGED IN'}\n`;
  
  debugDiv.innerHTML = `<pre>${debugText}</pre><button onclick="document.getElementById('debugInfo').remove()" style="background:#ff4444;color:white;border:none;padding:5px 10px;border-radius:5px;margin-top:10px;cursor:pointer;">Close</button>`;
  
  // Remove existing debug info if present
  const existing = document.getElementById('debugInfo');
  if (existing) existing.remove();
  
  document.body.appendChild(debugDiv);
}

// Test Firebase Connection
async function testFirebaseConnection() {
  const debugDiv = document.getElementById('debugInfo');
  if (!debugDiv) return;
  
  let testResult = '\n\nüß™ FIREBASE CONNECTION TEST:\n';
  
  try {
    // Test 1: Basic Firebase connection
    testResult += `‚úÖ Firebase DB object exists\n`;
    
    // Test 2: Try to read a simple document
    const testDoc = await getDoc(doc(db, 'system', 'test'));
    testResult += `‚úÖ Firebase read operation works\n`;
    
    // Test 3: Try to read tankData collection
    const tankDataTest = await getDoc(doc(db, 'tankData', 'plcr'));
    testResult += `${tankDataTest.exists() ? '‚úÖ' : '‚ùå'} tankData/plcr document ${tankDataTest.exists() ? 'EXISTS' : 'NOT FOUND'}\n`;
    
    // Test 4: Try to read tanks collection
    if (typeof getDocs !== 'undefined') {
      const tanksCollectionRef = collection(db, 'tankData', 'plcr', 'tanks');
      const tanksSnapshot = await getDocs(tanksCollectionRef);
      testResult += `${tanksSnapshot.size > 0 ? '‚úÖ' : '‚ùå'} tanks collection has ${tanksSnapshot.size} documents\n`;
    } else {
      testResult += `‚ùå getDocs function not available\n`;
    }
    
  } catch (error) {
    testResult += `‚ùå Firebase Error: ${error.message}\n`;
  }
  
  debugDiv.innerHTML += `<pre>${testResult}</pre>`;
}
// ÿ£ÿ∂ŸÅ Ÿáÿ∞ÿß ÿßŸÑŸÉŸàÿØ ŸÖÿπ ÿßŸÑŸÄ Debug Button

// ÿ™ÿ≠ÿØŸäÿ´ ÿØÿßŸÑÿ© showDebugInfo ŸÑÿ™ÿ¥ŸÖŸÑ ÿßÿÆÿ™ÿ®ÿßÿ± Firebase
function showDebugInfo() {
  const debugDiv = document.createElement('div');
  debugDiv.id = 'debugInfo';
  debugDiv.style.cssText = 'position:fixed;top:100px;right:10px;background:rgba(0,0,0,0.9);color:#00ff00;padding:20px;border-radius:10px;z-index:9999;max-width:400px;font-family:monospace;font-size:12px;max-height:500px;overflow-y:auto;';
  
  let debugText = `üîç PLCR DEBUG INFO:\n\n`;
  debugText += `üìä Total tanks loaded: ${Object.keys(tanks).length}\n`;
  debugText += `üìã Available tanks: ${Object.keys(tanks).slice(0,10).join(', ')}${Object.keys(tanks).length > 10 ? '...' : ''}\n\n`;
  
  debugText += `üîç Tank 467 exists: ${tanks.hasOwnProperty('467') ? 'YES' : 'NO'}\n`;
  if (tanks['467']) {
    debugText += `üìÑ Tank 467 data: ${JSON.stringify(tanks['467'])}\n`;
  }
  
  debugText += `\nüîß Firebase Connection: ${typeof db !== 'undefined' ? 'CONNECTED' : 'FAILED'}\n`;
  debugText += `üîß getDocs function: ${typeof getDocs !== 'undefined' ? 'AVAILABLE' : 'MISSING'}\n`;
  debugText += `üîß collection function: ${typeof collection !== 'undefined' ? 'AVAILABLE' : 'MISSING'}\n`;
  
  debugText += `\nüìÇ Firebase Paths Tested:\n`;
  debugText += `‚Ä¢ tankData/plcr/tanks (collection)\n`;
  debugText += `‚Ä¢ tankData/plcr (document)\n`;
  
  debugText += `\nüéØ Current User: ${currentUser ? currentUser.username : 'NOT LOGGED IN'}\n`;
  
  debugDiv.innerHTML = `<pre>${debugText}</pre>
    <button onclick="testFirebaseData()" style="background:#4CAF50;color:white;border:none;padding:8px 15px;border-radius:5px;margin:5px;cursor:pointer;">üß™ Test Firebase</button>
    <button onclick="document.getElementById('debugInfo').remove()" style="background:#ff4444;color:white;border:none;padding:8px 15px;border-radius:5px;margin:5px;cursor:pointer;">Close</button>`;
  
  // Remove existing debug info if present
  const existing = document.getElementById('debugInfo');
  if (existing) existing.remove();
  
  document.body.appendChild(debugDiv);
}

// ÿßÿÆÿ™ÿ®ÿßÿ± ŸÇÿ±ÿßÿ°ÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ŸÖŸÜ Firebase ŸÖÿ®ÿßÿ¥ÿ±ÿ©
async function testFirebaseData() {
  const debugDiv = document.getElementById('debugInfo');
  if (!debugDiv) return;
  
  let testResult = '\n\nüß™ FIREBASE DATA TEST:\n';
  
  try {
    // Test 1: ŸÇÿ±ÿßÿ°ÿ© collection ŸÖÿ®ÿßÿ¥ÿ±ÿ©
    testResult += `üîç Reading tankData/plcr/tanks collection...\n`;
    const tanksCollectionRef = collection(db, 'tankData', 'plcr', 'tanks');
    const tanksSnapshot = await getDocs(tanksCollectionRef);
    
    testResult += `üìä Collection size: ${tanksSnapshot.size}\n`;
    
    if (!tanksSnapshot.empty) {
      let sampleCount = 0;
      tanksSnapshot.forEach((doc) => {
        if (sampleCount < 3) { // Show first 3 tanks as samples
          const tankId = doc.id;
          const tankData = doc.data();
          testResult += `üìÑ Tank ${tankId}: ${JSON.stringify(tankData)}\n`;
          sampleCount++;
        }
      });
      if (tanksSnapshot.size > 3) {
        testResult += `... and ${tanksSnapshot.size - 3} more tanks\n`;
      }
    } else {
      testResult += `‚ùå Collection is empty!\n`;
    }
    
    // Test 2: ŸÇÿ±ÿßÿ°ÿ© document
    testResult += `\nüîç Reading tankData/plcr document...\n`;
    const plcrDoc = await getDoc(doc(db, 'tankData', 'plcr'));
    if (plcrDoc.exists()) {
      const docData = plcrDoc.data();
      testResult += `üìÑ Document fields: ${Object.keys(docData).join(', ')}\n`;
      if (docData.tanks) {
        const tankKeys = Object.keys(docData.tanks);
        testResult += `üìä Document has ${tankKeys.length} tanks: ${tankKeys.slice(0,5).join(', ')}\n`;
      }
    } else {
      testResult += `‚ùå Document does not exist!\n`;
    }
    
  } catch (error) {
    testResult += `‚ùå Firebase Error: ${error.message}\n`;
  }
  
  debugDiv.innerHTML += `<pre>${testResult}</pre>`;
}
// Initialize debug button after page load
setTimeout(createDebugButton, 2000);
  </script>
</body>
</html>