<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PLCR - Tank Calculator</title>
  <link href="icon.png" rel="icon" type="image/png"/>
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#003366">
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:Arial,sans-serif;margin:0;padding:20px;background:linear-gradient(rgba(0,0,0,0.5),rgba(0,0,0,0.5)),url('background.jpg');background-size:cover;background-position:center;background-attachment:fixed;color:white;direction:ltr;min-height:100vh}
    h2{color:white;text-align:center}
    .nav-bar{display:flex;justify-content:space-between;align-items:center;padding:10px 20px;background:rgba(0,0,0,0.5);border-radius:10px;margin-bottom:20px;flex-wrap:wrap}
    .nav-logo{font-size:24px;font-weight:bold;color:white}
    .nav-links{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .nav-link{color:white;text-decoration:none;padding:8px 16px;border-radius:8px;transition:all 0.3s ease;background:rgba(255,255,255,0.1);font-weight:500;border:1px solid rgba(255,255,255,0.2)}
    .nav-link:hover{background:rgba(255,255,255,0.2);transform:translateY(-1px)}
    .nav-link.active{background:rgba(255,255,255,0.3);font-weight:bold;border:1px solid rgba(255,255,255,0.4)}
    .nav-admin{background:linear-gradient(45deg,#FFD700,#FFA500);color:#003366;font-weight:bold;border-radius:8px;padding:8px 16px;text-decoration:none;transition:all 0.3s ease;border:1px solid #FFA500;font-size:inherit}
    .nav-admin:hover{transform:translateY(-1px);box-shadow:0 4px 12px rgba(255,215,0,0.3)}
    .nav-user{display:flex;align-items:center;gap:10px;background:rgba(255,255,255,0.1);padding:5px 15px;border-radius:20px;backdrop-filter:blur(10px)}
    .user-avatar{width:30px;height:30px;border-radius:50%;background:linear-gradient(45deg,#4CAF50,#45a049);display:flex;align-items:center;justify-content:center;font-weight:bold;font-size:14px}
    .logout-btn{background:rgba(255,0,0,0.2);border:1px solid rgba(255,0,0,0.5);color:white;padding:5px 10px;border-radius:5px;cursor:pointer;font-size:12px;transition:all 0.3s ease}
    .font-controls{display:flex;gap:5px;margin-right:10px}
    .font-btn{background:rgba(255,255,255,0.2);border:1px solid rgba(255,255,255,0.3);color:white;padding:5px 10px;border-radius:5px;cursor:pointer;font-size:14px;font-weight:bold;transition:all 0.3s ease;min-width:30px}
    .font-btn:hover{background:rgba(255,255,255,0.3);transform:translateY(-1px)}
    .container{background:rgba(255,255,255,0.1);padding:20px;border-radius:10px;max-width:600px;margin:auto;box-shadow:0 0 10px rgba(0,0,0,0.3);backdrop-filter:blur(10px)}
    label,input,select{display:block;width:100%;margin:10px 0;text-align:left}
    input,select{padding:10px;border-radius:8px;border:none;background:rgba(255,255,255,0.9);color:#003366;box-shadow:0 2px 5px rgba(0,0,0,0.3)}
    .result{margin-top:20px;font-weight:bold;text-align:center;color:#00ffff;padding:15px;background:rgba(0,0,0,0.3);border-radius:8px}
    footer{margin-top:40px;color:#ccc;text-align:center}
    .whatsapp-link{color:#25D366;text-decoration:none;font-weight:bold;transition:all 0.3s ease;cursor:pointer}
    .whatsapp-link:hover{color:#128C7E;text-shadow:0 0 5px rgba(37,211,102,0.5);transform:scale(1.05)}
    .action-button{position:fixed;width:40px;height:40px;border-radius:50%;background:rgba(255,255,255,0.3);border:none;font-size:20px;color:white;box-shadow:0 2px 5px rgba(0,0,0,0.3);cursor:pointer;display:flex;align-items:center;justify-content:center;top:10px;right:10px}
    .dark-mode{background:linear-gradient(rgba(0,0,0,0.8),rgba(0,0,0,0.8)),url('background.jpg')!important}
    .dark-mode .result{color:#ffcc00!important}
    .dark-mode input,.dark-mode select{background:rgba(50,50,70,0.9)!important;color:#eee!important}
    .dark-mode .container{background:rgba(40,40,60,0.3)!important}
    .access-denied{position:fixed;top:0;left:0;width:100%;height:100%;background:linear-gradient(rgba(0,0,0,0.8),rgba(0,0,0,0.8)),url('background.jpg');background-size:cover;background-position:center;display:flex;justify-content:center;align-items:center;z-index:9999}
    .access-denied-content{text-align:center;background:rgba(255,255,255,0.1);padding:40px;border-radius:20px;backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,0.2)}
    .access-denied-icon{font-size:5rem;color:#f44336;margin-bottom:20px}
    .access-denied-title{font-size:2rem;color:#f44336;margin-bottom:15px}
    .access-denied-text{font-size:1.2rem;margin-bottom:20px;opacity:0.8}
    .login-btn{padding:12px 25px;background:linear-gradient(45deg,#4CAF50,#45a049);color:white;border:none;border-radius:10px;cursor:pointer;font-size:16px;transition:all 0.3s ease;margin:5px}
    .security-modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.9);z-index:9999;backdrop-filter:blur(5px)}
    .security-modal.show{display:flex;justify-content:center;align-items:center}
    .security-modal-content{background:rgba(255,255,255,0.95);padding:30px;border-radius:15px;max-width:500px;width:90%;color:#003366;text-align:center;animation:modalSlideIn 0.5s ease}
    @keyframes modalSlideIn{from{opacity:0;transform:scale(0.8)}to{opacity:1;transform:scale(1)}}
    .security-icon{font-size:3rem;margin-bottom:15px}
    .security-title{font-size:1.5rem;margin-bottom:15px;font-weight:bold}
    .security-text{margin-bottom:20px;line-height:1.5}
    .attempt-counter{background:rgba(255,193,7,0.2);border:1px solid rgba(255,193,7,0.5);color:#f57c00;padding:10px;border-radius:8px;margin:15px 0;font-weight:bold}
    .security-buttons{display:flex;gap:10px;justify-content:center;flex-wrap:wrap}
    .modal-btn{padding:10px 20px;border:none;border-radius:8px;cursor:pointer;font-weight:500;transition:all 0.3s ease}
    .modal-btn-primary{background:#4CAF50;color:white}
    .modal-btn-secondary{background:#2196F3;color:white}
    .modal-btn-danger{background:#f44336;color:white}
    .modal-btn:hover{transform:translateY(-2px);box-shadow:0 5px 15px rgba(0,0,0,0.3)}
    @media (max-width:600px){
      .nav-bar{flex-direction:column;gap:15px;padding:15px}
      .nav-links{order:1;justify-content:center;width:100%}
      .nav-user{order:2;width:100%;justify-content:space-between}
      .nav-link{padding:10px 15px;font-size:14px}
      .nav-admin{padding:10px 15px;font-size:14px;display:inline-flex;align-items:center}
      .container{padding:15px;margin:10px}
      .security-buttons{flex-direction:column}
      .modal-btn{width:100%}
    }
  </style>
</head>
<body>
  <!-- Security Modal -->
  <div id="securityModal" class="security-modal">
    <div class="security-modal-content">
      <div class="security-icon" id="securityIcon">âš ï¸</div>
      <div class="security-title" id="securityTitle">Security Warning</div>
      <div class="security-text" id="securityText">We detected you trying to access developer tools.</div>
      <div class="attempt-counter" id="attemptCounter">Attempts: <span id="attemptCount">1</span>/3</div>
      <div class="security-buttons">
        <button class="modal-btn modal-btn-primary" onclick="acknowledgeWarning()">I Understand</button>
        <button class="modal-btn modal-btn-secondary" onclick="resetPage()">Reset Page</button>
        <button class="modal-btn modal-btn-danger" onclick="learnMore()">Learn More</button>
      </div>
    </div>
  </div>

  <!-- Access Denied -->
  <div id="accessDenied" class="access-denied" style="display:none">
    <div class="access-denied-content">
      <div class="access-denied-icon">ğŸ”’</div>
      <div class="access-denied-title">Login Required</div>
      <div class="access-denied-text">You need to login to access PLCR Calculator.<br>Please login with your KNPC credentials.</div>
      <button class="login-btn" onclick="goToLogin()">Go to Login</button>
    </div>
  </div>

  <!-- Main Content -->
  <div id="mainContent" style="display:none">
    <div class="nav-bar">
      <div class="nav-logo">Tank Tools</div>
      <div class="nav-links">
        <a class="nav-link" href="index.html">PBCR</a>
        <a class="nav-link active" href="plcr.html">PLCR</a>
        <a class="nav-link" href="NMOGASBL.html">NMOGAS</a>
        <a class="nav-link" href="live-tanks.html" id="liveTanksLink" style="display:none">ğŸ”´ Live Tanks</a>
        <a class="nav-admin" href="dashboard.html" id="adminLink" style="display:none">ğŸ” Dashboard</a>
      </div>
      <div class="nav-user" id="navUser">
        <div class="font-controls">
          <button class="font-btn" onclick="decreaseFontSize()" title="ØªØµØºÙŠØ± Ø§Ù„Ø®Ø·">-</button>
          <button class="font-btn" onclick="increaseFontSize()" title="ØªÙƒØ¨ÙŠØ± Ø§Ù„Ø®Ø·">+</button>
        </div>
        <div class="user-avatar" id="userAvatar">U</div>
        <div id="userName">User</div>
        <button class="logout-btn" onclick="logout()">Logout</button>
      </div>
    </div>

    <div class="container">
      <h2>PLCR - Tank Calculator</h2>
      
      <label for="mode">Select Mode:</label>
      <select id="mode" onchange="calculate()">
        <option value="levelToBarrels">Level to Barrels</option>
        <option value="barrelsToLevel">Barrels to Level</option>
        <option value="tonToLevel">Metric Ton to Level</option>
        <option value="levelToTon">Level to Metric Ton</option>
      </select>
      
      <label for="tk">Tank Number:</label>
      <input type="number" id="tk" placeholder="e.g. 424" oninput="calculate()">

      <label id="inputLabel" for="value">Enter Value:</label>
      <input type="number" id="value" placeholder="Enter number" oninput="calculate()">

      <div class="result" id="result">Please enter tank number and value.</div>
    </div>
    
    <button id="darkModeButton" class="action-button" title="Dark Mode" onclick="toggleDarkMode()">ğŸŒ™</button>
    
    <footer>
      By <a href="#" class="whatsapp-link" onclick="openWhatsApp(); return false;">Fahad - 17877</a> â€“ Version v4.3
      <br><small style="color:#999;font-size:10px;margin-top:5px;display:block">ğŸ“± WhatsApp: +965 55222550</small>
    </footer>
  </div>
  
  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
    import { getFirestore, doc, getDoc, collection, getDocs } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
    import { getAuth, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';

    // ØªÙ‡ÙŠØ¦Ø© Firebase
    const app = initializeApp({
      apiKey: "AIzaSyD7lJcoY33FEC9d6eWy67QIO9SV4lS24pg",
      authDomain: "tank-tools-knpc-c2d95.firebaseapp.com",
      projectId: "tank-tools-knpc-c2d95",
      storageBucket: "tank-tools-knpc-c2d95.firebasestorage.app",
      messagingSenderId: "510062594324",
      appId: "1:510062594324:web:b892fd02007a5ca2f0da01"
    });
    
    // ØªØ¹Ø±ÙŠÙ Ø§Ù„Ø¯ÙˆØ§Ù„ ÙˆØ§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠØ©
    window.db = getFirestore(app);
    window.doc = doc;
    window.getDoc = getDoc;
    window.collection = collection;
    window.getDocs = getDocs;
    window.auth = getAuth(app);
    window.onAuthStateChanged = onAuthStateChanged;
    
    console.log("âœ… Firebase initialized successfully");
  </script>
  <script src="permissions.js"></script>
  <script>
    // ØªØ¹Ø±ÙŠÙ Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠØ©
    let currentUser = null;
    let tankCalibrationData = {};
    let darkMode = false;
    
    // ØªØ¹Ø±ÙŠÙ Ø¯ÙˆØ§Ù„ Ø§Ù„Ø£Ù…Ø§Ù† Ø¨Ø´ÙƒÙ„ Ø¹Ø§Ù„Ù…ÙŠ
    window.acknowledgeWarning = function() {
      let securityModal = document.getElementById('securityModal');
      securityModal.classList.remove('show');
    };

    window.resetPage = function() {
      window.location.reload();
    };

    window.learnMore = function() {
      alert('Learn More functionality not implemented yet.');
    };
    
    // ØªØ¹Ø±ÙŠÙ Ø¯ÙˆØ§Ù„ Ø§Ù„ØªÙ†Ù‚Ù„ ÙˆØ§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø´ÙƒÙ„ Ø¹Ø§Ù„Ù…ÙŠ
    window.goToLogin = function() {
      window.location.href = 'login.html';
    };

    window.logout = function() {
      window.auth.signOut().then(() => {
        console.log('User signed out');
        window.location.href = 'login.html';
      }).catch((error) => {
        console.error('Error signing out:', error);
      });
    };

    window.openWhatsApp = function() {
      window.open('https://wa.me/96555222550', '_blank');
    };

    window.increaseFontSize = function() {
      document.body.style.fontSize = (parseFloat(getComputedStyle(document.body).fontSize) + 1) + 'px';
    };

    window.decreaseFontSize = function() {
      document.body.style.fontSize = (parseFloat(getComputedStyle(document.body).fontSize) - 1) + 'px';
    };
    
    window.toggleDarkMode = function() {
      document.body.classList.toggle('dark-mode');
      darkMode = !darkMode;
      document.getElementById('darkModeButton').textContent = darkMode ? 'â˜€ï¸' : 'ğŸŒ™';
    };

    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙˆØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
    window.addEventListener('load', () => {
      setTimeout(() => {
        checkLogin();
      }, 100);
    });

    function checkLogin() {
      const s = sessionStorage.getItem('tanktools_session');
      const u = localStorage.getItem('tanktools_current_user');
      
      if (s !== 'active' || !u) {
        showAccess();
        return;
      }
      
      try {
        currentUser = JSON.parse(u);
        if (!currentUser || !currentUser.username) {
          showAccess();
          return;
        }
        
        // Initialize permissions manager if available
        if (window.PermissionsManager) {
          window.permissionsManager = new PermissionsManager();
          window.permissionsManager.loadUserPermissions(currentUser.username).then(() => {
            initApp();
          }).catch(() => {
            initApp(); // Continue even if permissions fail
          });
        } else {
          initApp();
        }
      } catch {
        showAccess();
      }
    }

    function showAccess() {
      document.getElementById('mainContent').style.display = 'none';
      document.getElementById('accessDenied').style.display = 'flex';
    }

    function initApp() {
      document.getElementById('mainContent').style.display = 'block';
      document.getElementById('accessDenied').style.display = 'none';
      loadUser();
      
      // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ§Ù†ÙƒØ§Øª Ø¨Ø¹Ø¯ ØªØ£Ø®ÙŠØ± Ù‚ØµÙŠØ± Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø¬Ø§Ù‡Ø²ÙŠØ© Firebase
      setTimeout(() => {
        loadTankCalibrationData();
      }, 1000);
      
      setupDark();
    }

    function loadUser() {
      if (!currentUser) return;
      
      const userNameElement = document.getElementById('userName');
      const userAvatarElement = document.getElementById('userAvatar');
      
      userNameElement.textContent = currentUser.username || currentUser.email?.split('@')[0] || 'User';
      userAvatarElement.textContent = (currentUser.username?.charAt(0) || currentUser.email?.charAt(0) || 'U').toUpperCase();
      
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ø£Ø¯Ù…Ù† ÙˆØ§Ù„ØªØ§Ù†ÙƒØ§Øª Ø§Ù„Ø­ÙŠØ©
      const adminLink = document.getElementById('adminLink');
      const liveTanksLink = document.getElementById('liveTanksLink');
      
      if (window.permissionsManager) {
        if (window.permissionsManager.hasPageAccess('admin')) {
          adminLink.style.display = 'block';
        }
        
        if (window.permissionsManager.hasPageAccess('liveTanks')) {
          liveTanksLink.style.display = 'block';
        }
      } else {
        // Fallback for admin access
        if (currentUser.username === 'fam030') {
          adminLink.style.display = 'block';
          liveTanksLink.style.display = 'block';
        }
      }
    }

    function setupDark() {
      const isDark = localStorage.getItem('darkMode') === 'true';
      if (isDark) {
        document.body.classList.add('dark-mode');
        darkMode = true;
        document.getElementById('darkModeButton').textContent = 'â˜€ï¸';
      }
    }

    // Ø¯Ø§Ù„Ø© ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø¹Ø§ÙŠØ±Ø© Ø§Ù„ØªØ§Ù†ÙƒØ§Øª Ù…Ù† Firestore
    async function loadTankCalibrationData() {
      const resultElement = document.getElementById('result');
      try {
        console.log('ğŸ”„ Loading tank calibration data...');
        resultElement.textContent = 'Loading tank data...';
        
        let dataLoaded = false;
        
        // Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ù…Ø¬Ù…ÙˆØ¹Ø© tankData/plcr
        try {
          console.log('ğŸ”„ Trying to load from tankData/plcr...');
          const plcrTankDataSnapshot = await getDoc(doc(window.db, 'tankData', 'plcr'));
          
          if (plcrTankDataSnapshot.exists()) {
            const plcrData = plcrTankDataSnapshot.data();
            if (plcrData) {
              tankCalibrationData = plcrData;
              console.log('âœ… Tank data loaded from tankData/plcr:', tankCalibrationData);
              dataLoaded = true;
              resultElement.textContent = 'Please enter tank number and value.';
            }
          }
        } catch (e) {
          console.log('âŒ Error loading from tankData/plcr:', e.message);
        }
        
        // Ø¥Ø°Ø§ ÙØ´Ù„ Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ù…Ù† Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ø£ÙˆÙ„ØŒ Ø¬Ø±Ø¨ Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ù‚Ø¯ÙŠÙ…
        if (!dataLoaded) {
          try {
            console.log('ğŸ”„ Trying to load from plcrTanks/tankCalibration...');
            const oldDocRef = doc(window.db, 'plcrTanks', 'tankCalibration');
            const oldDocSnap = await getDoc(oldDocRef);
            
            if (oldDocSnap.exists()) {
              tankCalibrationData = oldDocSnap.data();
              console.log('âœ… Tank data loaded from old path:', tankCalibrationData);
              dataLoaded = true;
              resultElement.textContent = 'Please enter tank number and value.';
            }
          } catch (error) {
            console.error('âŒ Error loading from old path:', error);
          }
        }
        
        // Ø¥Ø°Ø§ Ù„Ù… ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø£ÙŠ Ù…Ø³Ø§Ø±ØŒ Ø§Ø³ØªØ®Ø¯Ù… Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©
        if (!dataLoaded || Object.keys(tankCalibrationData).length === 0) {
          console.log('âš ï¸ Using fallback tank data');
          // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ù„Ù„ØªØ§Ù†ÙƒØ§Øª
          tankCalibrationData = {
            "424": {
              "level": [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15],
              "barrels": [0, 1000, 2000, 3000, 4000, 5000, 6000, 7000, 8000, 9000, 10000, 11000, 12000, 13000, 14000, 15000],
              "metricTon": [0, 150, 300, 450, 600, 750, 900, 1050, 1200, 1350, 1500, 1650, 1800, 1950, 2100, 2250]
            },
            "425": {
              "level": [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15],
              "barrels": [0, 1100, 2200, 3300, 4400, 5500, 6600, 7700, 8800, 9900, 11000, 12100, 13200, 14300, 15400, 16500],
              "metricTon": [0, 165, 330, 495, 660, 825, 990, 1155, 1320, 1485, 1650, 1815, 1980, 2145, 2310, 2475]
            },
            "426": {
              "level": [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15],
              "barrels": [0, 900, 1800, 2700, 3600, 4500, 5400, 6300, 7200, 8100, 9000, 9900, 10800, 11700, 12600, 13500],
              "metricTon": [0, 135, 270, 405, 540, 675, 810, 945, 1080, 1215, 1350, 1485, 1620, 1755, 1890, 2025]
            },
            "467": {
              "level": [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 17.771],
              "barrels": [0, 700, 1400, 2100, 2800, 3500, 4200, 4900, 5600, 6300, 7000, 7700, 8400, 9100, 9800, 10500, 11200, 11900, 12375],
              "metricTon": [0, 105, 210, 315, 420, 525, 630, 735, 840, 945, 1050, 1155, 1260, 1365, 1470, 1575, 1680, 1785, 1856]
            }
          };
          resultElement.textContent = 'Using fallback tank data. Please enter tank number and value.';
        }
      } catch (error) {
        console.error('âŒ Error loading tank calibration data:', error);
        resultElement.textContent = 'Error loading tank data: ' + error.message;
      }
    }

    // Ø¯Ø§Ù„Ø© Ø§Ù„Ø­Ø³Ø§Ø¨
    window.calculate = function() {
      const mode = document.getElementById('mode').value;
      const tankNumber = document.getElementById('tk').value;
      const valueInput = document.getElementById('value').value;
      const value = parseFloat(valueInput);
      const resultElement = document.getElementById('result');

      // ØªØ­Ø¯ÙŠØ« Ø¹Ù†ÙˆØ§Ù† Ø­Ù‚Ù„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø­Ø¯Ø¯
      const inputLabel = document.getElementById('inputLabel');
      switch (mode) {
        case 'levelToBarrels':
          inputLabel.textContent = 'Enter Level:';
          break;
        case 'barrelsToLevel':
          inputLabel.textContent = 'Enter Barrels:';
          break;
        case 'tonToLevel':
          inputLabel.textContent = 'Enter Metric Ton:';
          break;
        case 'levelToTon':
          inputLabel.textContent = 'Enter Level:';
          break;
      }

      if (!tankNumber) {
        resultElement.textContent = 'Please enter Tank Number.';
        return;
      }

      if (!valueInput) {
        resultElement.textContent = 'Please enter a value.';
        return;
      }

      if (isNaN(value)) {
        resultElement.textContent = 'Please enter a valid number.';
        return;
      }

      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ§Ù†Ùƒ
      if (!tankCalibrationData || Object.keys(tankCalibrationData).length === 0) {
        resultElement.textContent = 'Tank calibration data not loaded yet. Please wait...';
        return;
      }

      const tankData = tankCalibrationData[tankNumber];

      if (!tankData) {
        resultElement.textContent = 'Tank data not found for this tank number.';
        return;
      }

      let calculatedResult;

      switch (mode) {
        case 'levelToBarrels':
          calculatedResult = interpolate(tankData.level, tankData.barrels, value);
          resultElement.textContent = `Barrels: ${calculatedResult.toFixed(2)}`;
          break;
        case 'barrelsToLevel':
          calculatedResult = interpolate(tankData.barrels, tankData.level, value);
          resultElement.textContent = `Level: ${calculatedResult.toFixed(2)}`;
          break;
        case 'tonToLevel':
          calculatedResult = interpolate(tankData.metricTon, tankData.level, value);
          resultElement.textContent = `Level: ${calculatedResult.toFixed(2)}`;
          break;
        case 'levelToTon':
          calculatedResult = interpolate(tankData.level, tankData.metricTon, value);
          resultElement.textContent = `Metric Ton: ${calculatedResult.toFixed(2)}`;
          break;
        default:
          resultElement.textContent = 'Invalid mode selected.';
          break;
      }
    };

    // Ø¯Ø§Ù„Ø© Ø§Ù„Ø§Ø³ØªÙŠÙØ§Ø¡ Ø§Ù„Ø®Ø·ÙŠ
    function interpolate(x, y, x_val) {
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
      if (!x || !y || x.length === 0 || y.length === 0) {
        console.error('âŒ Invalid data for interpolation');
        return 0;
      }
      
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† x_val Ø¶Ù…Ù† Ø§Ù„Ù†Ø·Ø§Ù‚
      if (x_val < x[0]) {
        console.warn('âš ï¸ Value below minimum range, using minimum value');
        return y[0];
      }
      
      if (x_val > x[x.length - 1]) {
        console.warn('âš ï¸ Value above maximum range, using maximum value');
        return y[y.length - 1];
      }
      
      // Ø§Ù„Ø§Ø³ØªÙŠÙØ§Ø¡ Ø§Ù„Ø®Ø·ÙŠ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ
      for (let i = 0; i < x.length - 1; i++) {
        if (x_val >= x[i] && x_val <= x[i+1]) {
          return y[i] + (y[i+1] - y[i]) * ((x_val - x[i]) / (x[i+1] - x[i]));
        }
      }
      
      // ÙÙŠ Ø­Ø§Ù„Ø© Ø¹Ø¯Ù… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù†Ø·Ø§Ù‚ Ù…Ù†Ø§Ø³Ø¨
      return 0;
    }

    // Ù†Ø¸Ø§Ù… Ø§Ù„Ø£Ù…Ø§Ù† Ø§Ù„Ø°ÙƒÙŠ - Ù…Ø­Ø³Ù† Ù„Ù€ iPhone
    (function(){
      let attempts=0,modalOpen=false,isTyping=false,typingTimer=null;
      
      function initSecurity(){
        // ØªØ­Ø³ÙŠÙ† Ø§ÙƒØªØ´Ø§Ù iPhone ÙˆØªØªØ¨Ø¹ Ø§Ù„ÙƒØªØ§Ø¨Ø©
        const isIPhone=/iPad|iPhone|iPod/.test(navigator.userAgent);
        
        // Ù…Ø³ØªÙ…Ø¹Ø§Øª Ø£Ø­Ø¯Ø§Ø« Ù…ØªØ¹Ø¯Ø¯Ø© Ù„ØªØªØ¨Ø¹ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø´Ø§Ù…Ù„
        ["focusin","focus","input","keydown","keyup","touchstart"].forEach(eventType=>{
          document.addEventListener(eventType,e=>{
            if(e.target.matches('input,textarea,select')){
              isTyping=true;
              clearTimeout(typingTimer);
              typingTimer=setTimeout(()=>isTyping=false,isIPhone?1500:800);
            }
          },true);
        });
        
        // Ø£Ù…Ø§Ù† Ø¥Ø¶Ø§ÙÙŠ Ù„ØªÙØ§Ø¹Ù„Ø§Øª Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
        document.addEventListener('change',e=>{
          if(e.target.matches('input,textarea,select')){
            isTyping=true;
            clearTimeout(typingTimer);
            typingTimer=setTimeout(()=>isTyping=false,1000);
          }
        });
        
        // ØªØ­Ø³ÙŠÙ† Ø­Ø¸Ø± Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ø¹Ù†Ø¯ Ø§Ù„ÙƒØªØ§Ø¨Ø©
        document.addEventListener('contextmenu',e=>{
          if(isTyping||e.target.matches('input,textarea,select')||e.target.closest('input,textarea,select'))return;
          handleViolation('context-menu')(e);
        });
        
        document.addEventListener('selectstart',e=>{
          if(isTyping||e.target.matches('input,textarea,select')||e.target.closest('input,textarea,select'))return;
          handleViolation('text-selection')(e);
        });
        
        document.addEventListener('keydown',e=>{
          if(isTyping||e.target.matches('input,textarea,select')||e.target.closest('input,textarea,select'))return;
          const dangerous=[(e.ctrlKey&&e.key==='u'),(e.ctrlKey&&e.key==='s'),(e.ctrlKey&&e.shiftKey&&e.key==='I'),(e.key==='F12'),(e.ctrlKey&&e.shiftKey&&e.key==='C'),(e.ctrlKey&&e.shiftKey&&e.key==='J')];
          if(dangerous.some(c=>c))handleViolation('keyboard-shortcut')(e);
        });
        
        // Ø§ÙƒØªØ´Ø§Ù Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ø·ÙˆØ± Ù…Ø¹ ÙØ­Øµ Ø§Ù„ÙƒØªØ§Ø¨Ø©
        let devOpen=false;
        setInterval(()=>{
          if(isTyping)return;
          const threshold=160,wDiff=window.outerWidth-window.innerWidth,hDiff=window.outerHeight-window.innerHeight;
          if(wDiff>threshold||hDiff>threshold){
            if(!devOpen){devOpen=true;setTimeout(()=>{if(!isTyping)handleViolation('devtools-detected')()},500)}
          }else{devOpen=false}
        },isIPhone?5000:3000);
      }
      
      function handleViolation(type){
        return function(e){
          if(e&&e.preventDefault)e.preventDefault();
          attempts++;
          if(attempts===1)showWarning('first');
          else if(attempts===2)showWarning('second');
          else if(attempts>=3)showWarning('final');
          return false
        }
      }
      
      function showWarning(level){
        if(modalOpen)return;
        const modal=document.getElementById('securityModal'),icon=document.getElementById('securityIcon'),title=document.getElementById('securityTitle'),text=document.getElementById('securityText'),counter=document.getElementById('attemptCounter'),countSpan=document.getElementById('attemptCount');
        modalOpen=true;countSpan.textContent=attempts;
        if(level==='first'){
          icon.textContent='ğŸ‘€';title.textContent='Security Notice';
          text.innerHTML='<p>We noticed you tried to access developer tools on PLCR Calculator.</p><p><strong>If this was accidental:</strong> No problem! Click "I Understand" to continue.</p><p><strong>Note:</strong> This calculator contains KNPC tank conversion data.</p>';
          counter.style.background='rgba(33,150,243,0.2)';counter.style.borderColor='rgba(33,150,243,0.5)';counter.style.color='#2196F3'
        }else if(level==='second'){
          icon.textContent='âš ï¸';title.textContent='Security Warning';
          text.innerHTML='<p><strong>Second attempt detected on PLCR Calculator.</strong></p><p>Please note this system contains:</p><ul style="text-align:left;margin:10px 0"><li>Proprietary tank conversion algorithms</li><li>KNPC operational data</li><li>Protected calculation methods</li></ul><p>One more attempt will activate security measures.</p>';
          counter.style.background='rgba(255,193,7,0.2)';counter.style.borderColor='rgba(255,193,7,0.5)';counter.style.color='#ffc107'
        }else{
          icon.textContent='ğŸš«';title.textContent='PLCR Security Lock';
          text.innerHTML='<p><strong>Maximum attempts exceeded on PLCR Calculator.</strong></p><p>Enhanced monitoring activated for:</p><ul style="text-align:left;margin:10px 0"><li>Tank calculation protection</li><li>KNPC data security</li><li>System integrity maintenance</li></ul><p>Use "Reset Page" to continue normally.</p>';
          counter.style.background='rgba(244,67,54,0.2)';counter.style.borderColor='rgba(244,67,54,0.5)';counter.style.color='#f44336';
          setTimeout(()=>{if(attempts>=3)window.location.href='login.html'},3000);
        }
        modal.classList.add('show');
      }
      
      // ØªÙ‡ÙŠØ¦Ø© Ù†Ø¸Ø§Ù… Ø§Ù„Ø£Ù…Ø§Ù† Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
      document.addEventListener('DOMContentLoaded', initSecurity);
    })();
  </script>
</body>
</html>
